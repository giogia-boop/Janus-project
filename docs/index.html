<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>ðŸŒ¿ Janus â€“ Monitoraggio Meteo</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
    h1 { color: #2c3e50; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; background: #fff; }
    th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
    th { background: #e0e0e0; }
    .btn { display: inline-block; margin: 10px 5px; padding: 8px 12px; background: #2c3e50; color: white; text-decoration: none; border-radius: 6px; }
    .btn:hover { background: #34495e; }
  </style>
</head>
<body>
  <h1>ðŸŒ¿ Janus â€“ Monitoraggio Meteo</h1>
  <p>
    <a class="btn" href="data/dati.json">ðŸ“‚ Apri dati.json</a>
    <a class="btn" href="data/storico.csv">ðŸ“œ Scarica storico.csv</a>
    <a class="btn" href="storico.html">ðŸ“Š Vedi storico completo</a>
  </p>
  <p id="lastUpdate"></p>

  <h2>Inner Layer</h2>
  <table id="inner">
    <thead>
      <tr>
        <th>Stazione</th>
        <th>Ultimo aggiornamento</th>
        <th>Temperatura (Â°C)</th>
        <th>UmiditÃ  (%)</th>
        <th>Dew Point (Â°C)</th>
        <th>Pressione (hPa)</th>
        <th>Vento (km/h)</th>
        <th>Direzione</th>
        <th>Pioggia (mm/h)</th>
        <th>Totale Giorno (mm)</th>
        <th>Fonte</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <h2>Outer Layer</h2>
  <table id="outer">
    <thead>
      <tr>
        <th>Stazione</th>
        <th>Ultimo aggiornamento</th>
        <th>Temperatura (Â°C)</th>
        <th>UmiditÃ  (%)</th>
        <th>Dew Point (Â°C)</th>
        <th>Pressione (hPa)</th>
        <th>Vento (km/h)</th>
        <th>Direzione</th>
        <th>Pioggia (mm/h)</th>
        <th>Totale Giorno (mm)</th>
        <th>Fonte</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    async function loadData() {
      const resp = await fetch("data/dati.json");
      const data = await resp.json();
      document.getElementById("lastUpdate").textContent =
        "Ultimo aggiornamento: " + data.generated_at;

      const innerStations = ["grezzana","marzana","torricelle","gazzego","belvedere","biancospini","montorio","antonio_legnago","borgo_venezia","forte_san_mattia"];
      const outerStations = []; // da popolare piÃ¹ avanti

      fillTable("inner", data.stations, innerStations);
      fillTable("outer", data.stations, outerStations);
    }

    function fillTable(tableId, stations, keys) {
      const tbody = document.querySelector(`#${tableId} tbody`);
      tbody.innerHTML = "";
      keys.forEach(k => {
        const st = stations[k];
        if (!st) return;
        const d = st.data || {};
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${st.meta.name}</td>
          <td>${d.fetched_at || "--"}</td>
          <td>${d.temperatura || "--"}</td>
          <td>${d.umidita || "--"}</td>
          <td>${d.dew_point || "--"}</td>
          <td>${d.pressione || "--"}</td>
          <td>${d.vento_velocita || "--"}</td>
          <td>${d.vento_direzione || "--"}</td>
          <td>${d.pioggia_rate || "--"}</td>
          <td>${d.pioggia_totale || "--"}</td>
          <td><a href="${d.url}" target="_blank">Vai</a></td>
        `;
        tbody.appendChild(tr);
      });
    }

    loadData();
  </script>
</body>
</html>
